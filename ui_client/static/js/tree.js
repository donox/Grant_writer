let myData = [
    {
        "id": "rsltmsg_1iurzMYmUD2faE427cz8Yez1",
        "text": "                foo",
        "state": {
            "opened": true,
            "selected": false
        },
        "children": [
            {
                "id": "msg_msg_1iurzMYmUD2faE427cz8Yez1",
                "text": "                foo",
                "state": {
                    "opened": true,
                    "selected": false
                },
                "datums": {
                    "role": "user",
                    "content": "                foo"
                },
                "children": []
            },
            {
                "id": "msg_msg_VQCAolqz8NgswjvGRBN94xcA",
                "text": "The term \"foo\" was not specifi",
                "state": {
                    "opened": true,
                    "selected": false
                },
                "datums": {
                    "role": "assistant",
                    "content": "The term \"foo\" was not specified in the context of the uploaded documents, so the search did not yield any specific results related to your query. \n\nHowever, if you provide me with more details or the specific context in which \"foo\" is used or if you need assistance with a particular aspect of grant writing, I'd be glad to help further. For instance, if you require guidelines on how to structure a grant proposal or details on any specific sections, please provide that information, and I can offer relevant guidance using the documents you've uploaded."
                },
                "children": []
            }
        ],
        "thread": "jstest2"
    },
    {
        "id": "rsltmsg_zbadrgOBgbXIhN4Mu7leKPQB",
        "text": "                fooss",
        "state": {
            "opened": true,
            "selected": false
        },
        "children": [
            {
                "id": "msg_msg_zbadrgOBgbXIhN4Mu7leKPQB",
                "text": "                fooss",
                "state": {
                    "opened": true,
                    "selected": false
                },
                "datums": {
                    "role": "user",
                    "content": "                fooss"
                },
                "children": []
            },
            {
                "id": "msg_msg_KyPkiqvsGp33pfZ2ZaLXtZeM",
                "text": "It appears that the term \"foos",
                "state": {
                    "opened": true,
                    "selected": false
                },
                "datums": {
                    "role": "assistant",
                    "content": "It appears that the term \"fooss\" does not appear in any of the uploaded documents. If you could provide more context or clarify what specific information you need, I would be able to assist you more effectively.\n\nIf you need assistance with the content within your uploaded files, such as the \"Wonders & Worries Houston Expansion Proposal,\" I can help you with specifics like structuring a grant proposal, elaborating on budget requirements, or reviewing program descriptions. Please let me know how you would like to proceed!"
                },
                "children": []
            }
        ],
        "thread": "jstest2"
    },
    {
        "id": "rsltmsg_AO91DCsBMX2iMeqpx2FKTqf4",
        "text": "                gfgfddgh",
        "state": {
            "opened": true,
            "selected": false
        },
        "children": [
            {
                "id": "msg_msg_AO91DCsBMX2iMeqpx2FKTqf4",
                "text": "                gfgfddgh",
                "state": {
                    "opened": true,
                    "selected": false
                },
                "datums": {
                    "role": "user",
                    "content": "                gfgfddgh"
                },
                "children": []
            },
            {
                "id": "msg_msg_Ta9RnpIhX52JhvRth0UCmwCw",
                "text": "The term \"gfgfddgh\" does not m",
                "state": {
                    "opened": true,
                    "selected": false
                },
                "datums": {
                    "role": "assistant",
                    "content": "The term \"gfgfddgh\" does not match any content within the uploaded documents. However, as you have uploaded several documents related to \"Wonders & Worries,\" I can assist you with information or guidance based on those files. \n\nIt seems like the primary focus areas are grant proposals and organizational budgets for \"Wonders & Worries.\" If you need help with any of the following, feel free to let me know:\n\n1. **Grant Proposal Structuring** \u2013 Assistance with structuring grant proposals based on your uploaded documents.\n2. **Budget Preparation** \u2013 Reviewing and preparing budgets as found in files such as \"Wonders & Worries 2023 Organizational Budget.\"\n3. **Program Descriptions** \u2013 Crafting program narratives for funding proposals.\n4. **Financial Statements** \u2013 Interpreting or formatting financial statements like those present in the \"Wonders & Worries 2023 FYr-End Financial.\"\n\nPlease provide specific details or clarify what you need help with, and I will do my best to assist you using the relevant documents."
                },
                "children": []
            }
        ],
        "thread": "jstest2"
    },
    {
        "id": "rsltmsg_w1po3aGGj2sZ3ilZZN4Y1q51",
        "text": "               asad ",
        "state": {
            "opened": true,
            "selected": false
        },
        "children": [
            {
                "id": "msg_msg_w1po3aGGj2sZ3ilZZN4Y1q51",
                "text": "               asad ",
                "state": {
                    "opened": true,
                    "selected": false
                },
                "datums": {
                    "role": "user",
                    "content": "               asad "
                },
                "children": []
            },
            {
                "id": "msg_msg_flDvITHsOASSkis0VzSbkIRl",
                "text": "The term \"asad\" did not return",
                "state": {
                    "opened": true,
                    "selected": false
                },
                "datums": {
                    "role": "assistant",
                    "content": "The term \"asad\" did not return any specific results from the uploaded documents. However, I did locate some documents and key information about the \"Wonders & Worries\" organization, including the \"Houston Expansion Proposal\" and the budget for 2023.\n\nI can assist with the following based on the available documents:\n\n1. **Houston Expansion Proposal**:\n   - **Key Differentiators**: Wonders & Worries has been a leader in its field for over 22 years, serving over 15,500 clients. It offers the only clinically validated curriculum and support of its kind, delivered exclusively by Certified Child Life Specialists, available free of charge in English and Spanish.\n   - **Strategic Initiatives**: The proposal outlines strategic initiatives for opening a 5th location in South Houston and acquiring a permanent real estate asset. There are detailed goals and tactics for both phases, including location testing and acquiring a permanent flagship office.\n   - **Budget**: The budget overview includes specific funding requests for different years and detailed expense allocations for personnel, office setup, and other operational costs.\n\n2. **2023 Organizational Budget**:\n   - **Income**: The total income is projected to be $2,053,627, sourced from contributions, special events, grants, third-party fundraisers, and earned income.\n   - **Expenses**: The total expense matches the total income, covering salaries, rent, professional fees, IT and computer costs, program initiatives, and various other operational expenses.\n\nIf you need help crafting a specific section of a grant proposal or have other questions about the available documents, please let me know. I can assist in formulating content, structuring your proposal, or providing detailed financial insights based on the documents you have provided."
                },
                "children": []
            }
        ],
        "thread": "jstest2"
    }
]

function loadJsTree(treeId, jsonData) {
    $(document).ready(() => {
        $(`#${treeId}`).jstree({
            'core': {
                'data': jsonData,
                'themes': {
                    'name': 'default', // or 'default-dark' for a dark theme
                    'responsive': true,
                    'icons': true
                },
                'expand_selected_onload': true
            },
            'plugins': ['wholerow', 'types']
        }).on('ready.jstree', function () {
            $(this).jstree('open_all');
        }).on('click', '.jstree-anchor', function (e) {
            const nodeId = $(this).closest('.jstree-node').attr('id');
            const tree = $(`#${treeId}`).jstree(true);
            if (tree.is_open(nodeId)) {
                tree.close_node(nodeId, false);
            } else {
                tree.open_node(nodeId, false);
            }
        });
    });
}

// Function to expand a specific node
function expandNode(treeId, nodeId) {
    $(`#${treeId}`).jstree('open_node', nodeId);
}

// Function to collapse a specific node
function collapseNode(treeId, nodeId) {
    $(`#${treeId}`).jstree('close_node', nodeId);
}

// Function to expand all nodes
function expandAll(treeId) {
    $(`#${treeId}`).jstree('open_all');
}

// Function to collapse all nodes
function collapseAll(treeId) {
    $(`#${treeId}`).jstree('close_all');
}

// Function to get and print custom data of selected node
function printSelectedNodeCustomData() {
    let selectedNodeId = $('#queryTree').jstree('get_selected')[0]; // Get the ID of the selected node
    let selectedNode = $('#queryTree').jstree('get_node', selectedNodeId); // Get the node object
    let customData = selectedNode.original.datums; // Access the custom data
    console.log(customData); // Print the custom data to the console
}

// Bind to the select event to print custom data when a node is selected
$('#queryTree').on('select_node.jstree', function (e, data) {
    printSelectedNodeCustomData();
});

function layoutTree(treeName, treeData) {
    $(document).ready(() => {
        $(`#${treeName}`).jstree({
            'core': {
                'data': function (node, callback) {
                    // Use the static tree data for simplicity
                    if (node.id === "#") {
                        callback(treeData);
                    } else {
                        // Dynamically add the custom content for each node
                        let children = $.grep(treeData, function (n) {
                            return n.parent === node.id;
                        });
                        $.each(children, function (index, child) {
                            let customContent = '<div class="custom-node-content">';
                            customContent += '<p><strong>ID:</strong> ' + child.id + '</p>';
                            customContent += '<p><strong>Text:</strong> ' + child.text + '</p>';
                            customContent += '<p><strong>Description:</strong> ' + child.customData.description + '</p>';
                            customContent += '<p><strong>Created By:</strong> ' + child.customData.createdBy + '</p>';
                            customContent += '</div>';
                            child.text = child.text + customContent;
                        });
                        callback(children);
                    }
                },
                'themes': {
                    'name': 'default', // or 'default-dark' for a dark theme
                    'responsive': true,
                    'icons': true
                },
                'expand_selected_onload': true
            },
            'plugins': ['wholerow', 'types']
        }).on('ready.jstree', function () {
            $(this).jstree('open_all');
        }).on('click', '.jstree-anchor', function (e) {
            const nodeId = $(this).closest('.jstree-node').attr('id');
            const tree = $(`#${treeId}`).jstree(true);
            if (tree.is_open(nodeId)) {
                tree.close_node(nodeId, false);
            } else {
                tree.open_node(nodeId, false);
            }
        });

        // Initialize the jsTree with custom rendering
        $(`#${treeName}`).jstree({
            'core': {
                'data': function (node, callback) {
                    // Use the static tree data for simplicity
                    if (node.id === "#") {
                        callback(treeData);
                    } else {
                        // Dynamically add the custom content for each node
                        let children = $.grep(treeData, function (n) {
                            return n.parent === node.id;
                        });
                        $.each(children, function (index, child) {
                            let customContent = '<div class="custom-node-content">';
                            customContent += '<p><strong>ID:</strong> ' + child.id + '</p>';
                            customContent += '<p><strong>Text:</strong> ' + child.text + '</p>';
                            customContent += '<p><strong>Description:</strong> ' + child.customData.description + '</p>';
                            customContent += '<p><strong>Created By:</strong> ' + child.customData.createdBy + '</p>';
                            customContent += '</div>';
                            child.text = child.text + customContent;
                        });
                        callback(children);
                    }
                }
            }
        })
        // Bind to the open_node event to display custom layout when a node is expanded
        $(`#${treeName}`).on('open_node.jstree', function (e, data) {
            let openedNode = data.node; // Get the opened node
            showCustomLayout(openedNode); // Show the custom HTML layout with the node's data
        })
    })
}


// Function to show the custom layout for the expanded node
function showCustomLayout(node) {
    // Find the node element and its children container
    let nodeElement = $('#' + node.id + '_anchor').closest('.jstree-node');
    let childrenContainer = nodeElement.children('.jstree-children');

    // Create and append the custom layout
    let customLayout = $('<div class="custom-node-content"></div>');
    customLayout.append('<p><strong>ID:</strong> ' + node.id + '</p>');
    customLayout.append('<p><strong>Text:</strong> ' + node.text + '</p>');
    customLayout.append('<p><strong>Description:</strong> ' + node.original.datums.role + '</p>');
    customLayout.append('<p><strong>Created By:</strong> ' + node.original.datums.content + '</p>');
    customLayout.append('<button id="backToTree">Back to Tree</button>');

    // Append the custom layout to the children container
    childrenContainer.prepend(customLayout);

    // Bind the click event to the back button
    customLayout.find('#backToTree').on('click', function () {
        customLayout.remove(); // Remove the custom layout
    });
}

// loadJsTree('queryTree', myData)
// layoutTree('queryTree', myData);



